# mlpanel. Руководство пользователя

## Описание

**mlpanel** - инструмент для мониторинга результатов ML-проектов. Использую в основе фреймворк **MLflow**, позволяет логировать параметры, метрики и артефакты (в том числе, модели). При этом расширяет возможности, предоставляемые **MLflow** - организует одновременную работу с несколькими проектами.

Основные возможности:

    * управление проектами: создание, удаление, мониторинг результатов пайплайнов, одновременная работа с нескольми проектами;
    * мониторинг экспериментов, запусков и моделей по проектам;
    * деплой моделей (локально и удаленно);
    * совместная (collaborative) работа (при установке на удалённый сервер).


## Описание сущностей

### Project (Проект)

Соответствует ML-проекту. Характеризуется именем и портом трекинг сервера. Запуск проект = запуск трекинг-сервера **MLflow**.


### Experimnent (Эксперимент)

Группа нескольких запусков под единым именем.

### Run (Запуск)

Результат одного запуска ML-пайплайна. Запись запуска состоит из параметров, метрик и артефактов.


### Artifact (Артефакт)

Любой файл или папка (в случае модели).

### RegisteredModel (Зарегистрированная модель)

**MLflow** (с версии 1.4.0) позволяет добавляет артефакты-модели в [Model Registry](https://www.mlflow.org/docs/latest/model-registry.html). В результате создаются записи о моделях.
Зарегистрированная модель характеризуется её именем.


### ModelVersion (Версия зарегистрированной модели)

Зарегистрированна модель может иметь несколько версий.
Версия модели хранит имя модели, номер версии, id запуска и путь к модели.
Версии одной и той же модели могут ссылаться на артефакты-модели разных экспериментов.


### Deployment (Деплоймент)

Касается развертываения моделей. Содержит данные о проекте и модели, которым соотвествует.
Типы деплойментов:

* local: развертывание модели локально;
* gcp: для развертываения используется GCE (создается новая виртуальная машина).

## Обзор API.

API строится вокруг сущностей. Группы эндоинтов соответствуют сущностям.
Например, для проектов:

```
GET /projects  - получить список проектов
POST /deployments - создаеть деплоймент
```

***Подробнее об API см. swagger-спецификацию.***

Основые операции с использоваением API (для большинства сущностей):

* создать (кроме артефактов);
* получить объект по id (кроме артефактов);
* получить список объектов;
* удалить.

Для некоторых сущностей есть дополнителые операции:

* Project:
  * запустить (run): запускается трекинг сервер **MLflow**;
  * остановаить (terminate): трекинг-сервер останавливается;
* Deployments:
  * запустить (run): запускается процесс деплоя модели;
  * предсказание (predict);
  * оставновить (stop): завершается процесс с моделью.

Замечания:

* объекты **MLflow** (**Experiment** и **Run**), а также **Deployment** при удалении физически не удаляются, а только помечаются как удалённые; при этом помеченные как удаленные объекты не возвращаются при запросах через API;

* если эксперимент создается не из **mlpanel** API, а из **MLflow** API, то:
  * время его создания = времени начала первого его запуска;
  * время последнего изменения = времени оконочания последнего запуска.


Способы работы с API:

* swagger-спецификация + любой инструмент для выполнения http-запросов (curl, библиотеки языков программирования);
* swagger-спецификация + [swagger editor](https://editor.swagger.io);
* реализовать свою UI-обёртку с использованием frontend-фреймворков или на vanilla js.

## Типовой алгоритм действий пользователя

1. создать проект;
2. запустить проект;
3. получить URL трекинг-сервера;
4. запустить свой ML-проект (в котором используется **MLflow**):

```bash
export MLFLOW_TRACKING_URI=<tracking server URL>
python run.py
```

Далее - одна из возможностей:

* мониторинг/изучение результатов запусков;
* регистрация моделей;
* деплой зарегистрированных моделей.


**Чтобы попробовать все возможности и пройти этапы, запустите ноутбук *projects/examples/notebooks/demo.ipynb***
**Замечание**: demo-нотбук предполагает локальное хранилище артефактов. 
Т.е., в *.env* поле `ARTIFACT_STORE` должно выглядеть примерно так:
```.env
# полный путь к локальному хранилищу артефактов = '<WORKSPACE>/<project_name>/<ARTIFACT_STORE>
ARTIFACT_STORE=mlruns  
``` 
 
 
 ## Особенности и замечания:
 
 * **деплой локальный моделей** возможен только локально; 